<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장치 등록 - 가챠 무인 판매기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        .step-indicator {
            background: #e5e7eb;
            color: #6b7280;
        }
        .step-indicator.active {
            background: #3b82f6;
            color: white;
        }
        .step-indicator.completed {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl w-full space-y-8">
            <!-- 헤더 -->
            <div class="text-center">
                <i class="fas fa-robot text-6xl text-blue-600 mb-4"></i>
                <h2 class="text-3xl font-extrabold text-gray-900">
                    가챠 무인 판매기 장치 등록
                </h2>
                <p class="mt-2 text-sm text-gray-600">
                    새로운 장치를 시스템에 등록합니다
                </p>
            </div>

            <!-- 진행 단계 표시 -->
            <div class="flex justify-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="step-indicator active w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium">
                            1
                        </div>
                        <span class="ml-2 text-sm font-medium text-gray-900">기본 정보</span>
                    </div>
                    <div class="w-16 h-0.5 bg-gray-300"></div>
                    <div class="flex items-center">
                        <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium">
                            2
                        </div>
                        <span class="ml-2 text-sm font-medium text-gray-500">시스템 정보</span>
                    </div>
                    <div class="w-16 h-0.5 bg-gray-300"></div>
                    <div class="flex items-center">
                        <div class="step-indicator w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium">
                            3
                        </div>
                        <span class="ml-2 text-sm font-medium text-gray-500">확인</span>
                    </div>
                </div>
            </div>

            <!-- 등록 폼 -->
            <div class="bg-white shadow-xl rounded-lg p-8">
                <form id="registrationForm">
                    <!-- 1단계: 기본 정보 -->
                    <div class="form-step active" id="step1">
                        <h3 class="text-lg font-medium text-gray-900 mb-6">기본 정보 입력</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="hardwareId" class="block text-sm font-medium text-gray-700">
                                    하드웨어 ID *
                                </label>
                                <input type="text" id="hardwareId" name="hardwareId" required
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: VM001SEOUL2024">
                                <p class="mt-1 text-xs text-gray-500">8-64자의 영숫자 조합</p>
                            </div>
                            <div>
                                <label for="tenantId" class="block text-sm font-medium text-gray-700">
                                    테넌트 ID *
                                </label>
                                <input type="text" id="tenantId" name="tenantId" required
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: 550e8400-e29b-41d4-a716-446655440001">
                                <p class="mt-1 text-xs text-gray-500">UUID 형식</p>
                            </div>
                            <div>
                                <label for="ipAddress" class="block text-sm font-medium text-gray-700">
                                    IP 주소 *
                                </label>
                                <input type="text" id="ipAddress" name="ipAddress" required
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: 192.168.1.101">
                                <p class="mt-1 text-xs text-gray-500">IPv4 형식</p>
                            </div>
                            <div>
                                <label for="location" class="block text-sm font-medium text-gray-700">
                                    설치 위치
                                </label>
                                <input type="text" id="location" name="location"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: 서울 강남구">
                            </div>
                        </div>
                    </div>

                    <!-- 2단계: 시스템 정보 -->
                    <div class="form-step" id="step2">
                        <h3 class="text-lg font-medium text-gray-900 mb-6">시스템 정보 입력</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="os" class="block text-sm font-medium text-gray-700">
                                    운영체제 *
                                </label>
                                <select id="os" name="os" required
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">선택하세요</option>
                                    <option value="Ubuntu">Ubuntu</option>
                                    <option value="CentOS">CentOS</option>
                                    <option value="Windows">Windows</option>
                                    <option value="Raspberry Pi OS">Raspberry Pi OS</option>
                                </select>
                            </div>
                            <div>
                                <label for="version" class="block text-sm font-medium text-gray-700">
                                    버전 *
                                </label>
                                <input type="text" id="version" name="version" required
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: 22.04.3 LTS">
                            </div>
                            <div>
                                <label for="architecture" class="block text-sm font-medium text-gray-700">
                                    아키텍처 *
                                </label>
                                <select id="architecture" name="architecture" required
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">선택하세요</option>
                                    <option value="x86_64">x86_64</option>
                                    <option value="x64">x64</option>
                                    <option value="armv7l">armv7l</option>
                                    <option value="aarch64">aarch64</option>
                                </select>
                            </div>
                            <div>
                                <label for="memory" class="block text-sm font-medium text-gray-700">
                                    메모리 *
                                </label>
                                <select id="memory" name="memory" required
                                        class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">선택하세요</option>
                                    <option value="4GB">4GB</option>
                                    <option value="8GB">8GB</option>
                                    <option value="16GB">16GB</option>
                                    <option value="32GB">32GB</option>
                                </select>
                            </div>
                            <div>
                                <label for="storage" class="block text-sm font-medium text-gray-700">
                                    저장소 *
                                </label>
                                <input type="text" id="storage" name="storage" required
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: 256GB SSD">
                            </div>
                            <div>
                                <label for="cpuModel" class="block text-sm font-medium text-gray-700">
                                    CPU 모델
                                </label>
                                <input type="text" id="cpuModel" name="cpuModel"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="예: Intel Core i5-12400">
                            </div>
                        </div>
                    </div>

                    <!-- 3단계: 확인 -->
                    <div class="form-step" id="step3">
                        <h3 class="text-lg font-medium text-gray-900 mb-6">등록 정보 확인</h3>
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div id="confirmationContent">
                                <!-- 동적으로 생성될 확인 내용 -->
                            </div>
                        </div>
                        
                        <!-- 등록 상태 -->
                        <div id="registrationStatus" class="mt-6 hidden">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <i class="fas fa-spinner fa-spin text-blue-600 mr-3"></i>
                                    <div>
                                        <h4 class="text-sm font-medium text-blue-900">등록 처리 중...</h4>
                                        <p class="text-sm text-blue-700">장치 등록 요청을 처리하고 있습니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 등록 완료 -->
                        <div id="registrationComplete" class="mt-6 hidden">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-center">
                                    <i class="fas fa-check-circle text-green-600 mr-3"></i>
                                    <div>
                                        <h4 class="text-sm font-medium text-green-900">등록 완료!</h4>
                                        <p class="text-sm text-green-700">장치 등록 요청이 성공적으로 제출되었습니다. 관리자 승인을 기다려주세요.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 버튼 -->
                    <div class="flex justify-between mt-8">
                        <button type="button" id="prevBtn" onclick="previousStep()" 
                                class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 hidden">
                            이전
                        </button>
                        <div class="flex space-x-3">
                            <button type="button" id="nextBtn" onclick="nextStep()"
                                    class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                다음
                            </button>
                            <button type="submit" id="submitBtn" 
                                    class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 hidden">
                                등록하기
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- 샘플 데이터 자동 입력 버튼 -->
            <div class="text-center">
                <button onclick="fillSampleData()" 
                        class="text-sm text-blue-600 hover:text-blue-800 underline">
                    샘플 데이터로 자동 입력
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let sampleData = {};

        // 샘플 데이터 로드
        async function loadSampleData() {
            try {
                const response = await fetch('./sample-data-ui.json');
                sampleData = await response.json();
            } catch (error) {
                console.error('샘플 데이터 로드 실패:', error);
            }
        }

        // 다음 단계
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < 3) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        }

        // 이전 단계
        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        // 단계 표시 업데이트
        function updateStepDisplay() {
            // 모든 단계 숨기기
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });

            // 현재 단계 표시
            document.getElementById(`step${currentStep}`).classList.add('active');

            // 단계 인디케이터 업데이트
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    indicator.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    indicator.classList.add('active');
                }
            });

            // 버튼 표시/숨기기
            document.getElementById('prevBtn').classList.toggle('hidden', currentStep === 1);
            document.getElementById('nextBtn').classList.toggle('hidden', currentStep === 3);
            document.getElementById('submitBtn').classList.toggle('hidden', currentStep !== 3);

            // 3단계에서 확인 내용 생성
            if (currentStep === 3) {
                generateConfirmation();
            }
        }

        // 현재 단계 유효성 검사
        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    alert(`${field.previousElementSibling.textContent.replace(' *', '')} 항목을 입력해주세요.`);
                    return false;
                }
            }

            // IP 주소 형식 검증
            if (currentStep === 1) {
                const ipAddress = document.getElementById('ipAddress').value;
                const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
                if (!ipRegex.test(ipAddress)) {
                    alert('올바른 IP 주소 형식을 입력해주세요.');
                    return false;
                }
            }

            return true;
        }

        // 확인 내용 생성
        function generateConfirmation() {
            const formData = new FormData(document.getElementById('registrationForm'));
            const data = Object.fromEntries(formData);
            
            const content = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">기본 정보</h4>
                        <div class="space-y-2 text-sm">
                            <div><span class="text-gray-500">하드웨어 ID:</span> <span class="font-medium">${data.hardwareId}</span></div>
                            <div><span class="text-gray-500">테넌트 ID:</span> <span class="font-medium">${data.tenantId}</span></div>
                            <div><span class="text-gray-500">IP 주소:</span> <span class="font-medium">${data.ipAddress}</span></div>
                            <div><span class="text-gray-500">설치 위치:</span> <span class="font-medium">${data.location || '미입력'}</span></div>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">시스템 정보</h4>
                        <div class="space-y-2 text-sm">
                            <div><span class="text-gray-500">운영체제:</span> <span class="font-medium">${data.os} ${data.version}</span></div>
                            <div><span class="text-gray-500">아키텍처:</span> <span class="font-medium">${data.architecture}</span></div>
                            <div><span class="text-gray-500">메모리:</span> <span class="font-medium">${data.memory}</span></div>
                            <div><span class="text-gray-500">저장소:</span> <span class="font-medium">${data.storage}</span></div>
                            <div><span class="text-gray-500">CPU:</span> <span class="font-medium">${data.cpuModel || '미입력'}</span></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('confirmationContent').innerHTML = content;
        }

        // 폼 제출
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 등록 처리 중 표시
            document.getElementById('registrationStatus').classList.remove('hidden');
            document.getElementById('submitBtn').disabled = true;
            
            // 2초 후 완료 표시 (실제로는 API 호출)
            setTimeout(() => {
                document.getElementById('registrationStatus').classList.add('hidden');
                document.getElementById('registrationComplete').classList.remove('hidden');
                document.getElementById('submitBtn').textContent = '새 장치 등록';
                document.getElementById('submitBtn').disabled = false;
            }, 2000);
        });

        // 샘플 데이터 자동 입력
        function fillSampleData() {
            const sampleDevice = {
                hardwareId: 'VM999SAMPLE24',
                tenantId: '550e8400-e29b-41d4-a716-446655440999',
                ipAddress: '192.168.100.99',
                location: '서울 테스트구',
                os: 'Ubuntu',
                version: '22.04.3 LTS',
                architecture: 'x86_64',
                memory: '8GB',
                storage: '256GB SSD',
                cpuModel: 'Intel Core i5-12400'
            };

            Object.entries(sampleDevice).forEach(([key, value]) => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = value;
                }
            });

            alert('샘플 데이터가 입력되었습니다!');
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            updateStepDisplay();
        });
    </script>
</body>
</html>